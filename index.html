<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB손보 펫 플랫폼</title>
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <div id="wrap">
        <header class="gnb-m">
            <img src="assets/image/main1/12.png" alt="">
        </header>

        <main>
            <div class="info">
                <img src="assets/image/main1/1.png" alt="" class="scroll-eff">
                <button type="button" class="down-btn scroll-eff"><img src="assets/image/main1/1-1.png" alt=""></button>
            </div>

            <div class="main-box">
                <button type="button" class="close-btn"><img src="assets/image/main1/2.png" alt=""></button>
                <p class="h-bnr"><img src="assets/image/main1/5.png" alt=""></p>

                <div class="tab-container" id="main-tabs">
                    <ul role="tablist" class="full">
                        <li role="presentation">
                            <button type="button" id="main-tabs-tab-1" role="tab" aria-selected="true" aria-controls="main-tabs-panel-1" tabindex="0">우리집</button>
                        </li>
                        <li role="presentation">
                            <button type="button" id="main-tabs-tab-2" role="tab" aria-selected="false" aria-controls="main-tabs-panel-2" tabindex="-1">옆집</button>
                        </li>
                    </ul>

                    <div class="utils">
                        <span>알람</span>
                        <span>검색</span>
                    </div>

                    <div class="tab-panels">
                        <!--  우리집 -->
                        <div id="main-tabs-panel-1" class="house" role="tabpanel" aria-labelledby="main-tabs-tab-1" tabindex="0">

                            <!-- 서브 탭 -->
                            <div class="tab-container" id="sub-tabs">
                                <ul role="tablist">
                                    <li role="presentation">
                                        <button type="button" id="sub-tabs-tab-1" role="tab" aria-selected="true" aria-controls="sub-tabs-panel-1" tabindex="0">
                                            <img src="assets/image/main1/tab1.png" alt="">
                                            <img src="assets/image/main1/tab1-active.png" alt="" class="active">
                                        </button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="sub-tabs-tab-2" role="tab" aria-selected="false" aria-controls="sub-tabs-panel-2" tabindex="-1">
                                            <img src="assets/image/main1/tab2.png" alt="">
                                            <img src="assets/image/main1/tab2-active.png" alt="" class="active">
                                        </button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="sub-tabs-tab-3" role="tab" aria-selected="false" aria-controls="sub-tabs-panel-3" tabindex="-1">
                                            <img src="assets/image/main1/tab3.png" alt="">
                                            <img src="assets/image/main1/tab3-active.png" alt="" class="active">
                                        </button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="sub-tabs-tab-4" role="tab" aria-selected="false" aria-controls="sub-tabs-panel-4" tabindex="-1">
                                            <img src="assets/image/main1/tab4.png" alt="">
                                        </button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="sub-tabs-tab-5" role="tab" aria-selected="false" aria-controls="sub-tabs-panel-5" tabindex="-1">
                                             <img src="assets/image/main1/tab5.png" alt="">
                                        </button>
                                    </li>
                                </ul>
                                <div class="tab-panels">
                                    <!-- 숙제 -->
                                    <div id="sub-tabs-panel-1" role="tabpanel" aria-labelledby="sub-tabs-tab-1" tabindex="0">
                                        <a href=""><img src="assets/image/main1/4.png" alt=""></a>
                                        <a href="" class="trigger-pop"><img src="assets/image/main1/5.png" alt=""></a>
                                        <a href=""><img src="assets/image/main1/6.png" alt=""></a>
                                        <a href=""><img  src="assets/image/main1/7.png" alt=""></a>
                                        <a href="" class="box3-btn"><img src="assets/image/main1/8.png" alt=""></a>
                                        <a href="#" class="box2-btn"><img src="assets/image/main1/9.png" alt=""></a>
                                        <a href=""><img src="assets/image/main1/10.png" alt=""></a>
                                        <a href=""><img src="assets/image/main1/11.png" alt=""></a>
                                    </div>

                                    <!-- 기록 -->
                                    <div id="sub-tabs-panel-2" role="tabpanel" aria-labelledby="sub-tabs-tab-2" tabindex="0" hidden>
                                        <div class="history-container">
                                            <div class="box"><img src="assets/image/sub/history1.png" alt=""></div>
                                            <div class="box"><img src="assets/image/sub/history2.png" alt=""></div>
                                            <div class="box"><img src="assets/image/sub/history3.png" alt=""></div>
                                            <div class="box"><a href="insurance.html"><img src="assets/image/sub/history4.png" alt=""></a></div>
                                            <div class="box"><img src="assets/image/sub/history5.png" alt=""></div>
                                        </div>
                                    </div>

                                    <!-- 앨범 -->
                                    <div id="sub-tabs-panel-3" role="tabpanel" aria-labelledby="sub-tabs-tab-3" tabindex="0" hidden>
                                        <div class="album-container">
                                            <img src="assets/image/sub/album.png" alt="">
                                        </div>
                                    </div>
                                    
                                    <!-- 활동 -->
                                    <div id="sub-tabs-panel-4" role="tabpanel" aria-labelledby="sub-tabs-tab-4" tabindex="0" hidden>
                                        <h4>서브 패널 d</h4>
                                        <p>중첩된 탭의 두 번째 내용입니다.</p>
                                    </div>

                                    <!-- 내 유형 -->
                                    <div id="sub-tabs-panel-5" role="tabpanel" aria-labelledby="sub-tabs-tab-5" tabindex="0" hidden>
                                        <h4>서브 패널 F</h4>
                                        <p>중첩된 탭의 두 번째 내용입니다.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- // 서브 탭 -->
                            
                        </div>
                        <!--  // 우리집 -->

                        <!-- 옆집 -->
                        <div id="main-tabs-panel-2" role="tabpanel" aria-labelledby="main-tabs-tab-2" tabindex="0" hidden>
                            <div class="neighbor-house-container">
                                <div class="tab"><img src="assets/image/main2/tab.png" alt=""></div>
                                    <div class="visual">
                                        <img src="assets/image/main2/main1.png" alt="">
                                        <img src="assets/image/main2/main2.png" alt="">
                                    </div>
                                    <div class="banner">
                                        <img src="assets/image/main2/banner.png" alt="">
                                    </div>
                                    <div class="highlight">
                                        <h2>옆집 명장면</h2>
                                        <div class="inner">
                                            <img src="assets/image/main2/video1.png" alt="">
                                            <img src="assets/image/main2/video-btn.png" alt="">
                                            <img src="assets/image/main2/highlight.png" alt="">
                                        </div>
                                    </div>
                                    <div class="hot">
                                        <h2>시선집중 인기글</h2>
                                        <div class="inner">
                                            <img src="assets/image/main2/hot1.png" alt="">
                                            <img src="assets/image/main2/hot2.png" alt="">
                                            <img src="assets/image/main2/hot3.png" alt="">
                                        </div>
                                    </div>
                                    <div class="more">
                                        <img src="assets/image/main2/more.png" alt="">
                                    </div>
                            </div>
                        </div>
                        <!-- // 옆집 -->
                    </div>
                </div>
            </div>

            <div class="open-pop">
                <button type="button"><img src="assets/image/main1/13.png" alt=""></button>
            </div>

            <div class="box1">
                <img src="assets/image/main1/14.png" alt="" class="box1-top">
                <img src="assets/image/main1/close.png" alt="" class="box1-close">

                <div class="box1-in">
                    <img src="assets/image/main1/15.png" alt="">
                    <button type="button"><img src="assets/image/main1/16.png" alt="">꼬미 사진자랑하기</button>
                </div>

                <img src="assets/image/main1/17.png" alt="" class="box1-bottom">

                <button type="button" class="box1-pop1"><img src="assets/image/main1/18.png" alt=""></button>

                <div class="box1-pop2">
                    <button type="button"><img src="assets/image/main1/19.png" alt=""><img src="assets/image/main1/20.png" alt=""></button>
                </div>

                <div class="box1-pop3">
                    <button type="button"><img src="assets/image/main1/21.png" alt=""></button>
                </div>

                <div class="box1-pop4">
                    <img src="assets/image/main1/22.png" alt="">
                    <img src="assets/image/main1/close.png" alt="" class="box1-close">
                    <p><img src="assets/image/main1/24.png" alt=""></p>
                    <button type="button">
                        <img src="assets/image/main1/23.png" alt="">
                    </button>
                </div>

                <div class="box1-pop5">
                    <img src="assets/image/main1/25.png" alt="">
                    <button type="button"><img src="assets/image/main1/close.png" alt="" class="box1-close"></button>
                </div>
            </div>

            <div class="box2">
                <button type="button"><img src="assets/image/main1/26.png" alt=""></button>
            </div>

            <div class="box3">
                <button type="button" class="box3-step1"><img src="assets/image/main1/27.png" alt=""></button>
                <button type="button" class="box3-step2"><img src="assets/image/main1/28.png" alt=""></button>

                <button type="button" class="box3-step3">
                    <img src="assets/image/main1/29.png" alt="">
                </button>
                <button type="button" class="box3-step4">
                    <img src="assets/image/main1/30.png" alt="">
                </button>
                <button type="button" class="box3-step5">
                    <img src="assets/image/main1/31.png" alt="">
                </button>
            </div>
        </main>
    </div>
    <script src="assets/js/main.js"></script>
</body>
</html>

<script>
const headerbanner = () => {
    const banner = document.querySelector(".h-bnr");
    const banner2 = document.querySelector(".close-btn");

    window.addEventListener("scroll", function () {
        if (window.scrollY > 0 && banner && !banner.classList.contains("hidden")) {
            banner.classList.add("hidden");
            banner2.classList.add("on");
        }
    });
}

const scrolleff = () => {
    const items = document.querySelectorAll(".scroll-eff");

    const observer = new IntersectionObserver(
        (entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    const index = Array.from(items).indexOf(el);
                    el.style.transitionDelay = `${index * 0.1}s`;
                    el.classList.add("show");
                    observer.unobserve(el);
                }
            });
        },
        {
            threshold: 0.01
        }
    );

    items.forEach(item => {
        observer.observe(item);
    });
};

const popClose = () => {
    const btn = document.querySelector('.close-btn');
    const mainBox = document.querySelector('.main-box');

    btn.addEventListener('click', () => {
        btn.classList.add('hide');
        mainBox.style.paddingTop = 0;

        setTimeout(() => {
            btn.style.display = 'none';
        }, 500);
    });
};

const scrollToCloseBtn = () => {
    const downBtn = document.querySelector('.down-btn.scroll-eff');
    const closeBtn = document.querySelector('.close-btn');

    if (!downBtn || !closeBtn) return;

    downBtn.addEventListener('click', () => {
        const offset = 20;
        const target = closeBtn.getBoundingClientRect().top + window.scrollY - offset;

        scrollToSlow(target, 600);
    });
};

function scrollToSlow(targetY, duration = 400) {
    const currentY = window.scrollY;
    const distance = targetY - currentY;
    let start = null;

    window.requestAnimationFrame(step);

    function step(timestamp) {
        if (!start) start = timestamp;

        const progress = timestamp - start;
        window.scrollTo(0, easeInOutCubic(progress, currentY, distance, duration));
        if (progress < duration) window.requestAnimationFrame(step);
    }
}

const easeInOutCubic = (t, b, c, d) => {
    t /= d / 2;
    if (t < 1) return c / 2 * t * t * t + b;

    t -= 2;
    return c / 2 * (t * t * t + 2) + b;
} 

const openPopOnScroll = () => {
    const trigger = document.querySelector('.trigger-pop');
    const openPop = document.querySelector('.open-pop');
    let shown = false;

    if (!trigger || !openPop) return;

    const checkVisibility = () => {
        const rect = trigger.getBoundingClientRect();
        const windowHeight = window.innerHeight;

        if (rect.top < windowHeight / 4.5 && !shown) {
            openPop.style.display = 'flex';
            openPop.classList.add('fade-in');
            shown = true;
        }
    };

    window.addEventListener('scroll', checkVisibility);
    window.addEventListener('load', checkVisibility);
};

const openPopBox1 = () => {
    const btn = document.querySelector('.open-pop button');
    const pop = document.querySelector('.open-pop');
    const box1 = document.querySelector('.box1');
    const box1In = document.querySelector('.box1-in');
    const box1Inbtn = document.querySelector('.box1-in button');
    const box1pop1Btn = document.querySelector('.box1-pop1');
    const box1pop2wrap = document.querySelector('.box1-pop2');
    const box1pop3wrap = document.querySelector('.box1-pop3');
    const box1pop4wrap = document.querySelector('.box1-pop4');
    const box1pop5wrap = document.querySelector('.box1-pop5');
    

    btn.addEventListener('click', () => {
        box1.classList.add('on');

        setTimeout(() => {
            box1In.classList.add('on');
        }, 500);
    });

    box1Inbtn.addEventListener('click', () => {
        box1Inbtn.classList.add('on');

        setTimeout(() => {
            box1pop1Btn.classList.add('on');
        }, 400);
    });

    box1pop1Btn.addEventListener('click', () => {
        box1pop2wrap.classList.add('on');
    });

    box1pop2wrap.addEventListener('click', () => {
        box1pop2wrap.classList.remove('on');
        box1pop1Btn.classList.remove('on');

        box1In.addEventListener('click', () => {
            box1pop3wrap.classList.add('on');
        });
    });

    box1pop3wrap.addEventListener('click', () => {
        box1pop3wrap.classList.remove('on');
        box1pop4wrap.classList.add('on');
    });

    box1pop4wrap.addEventListener('click', () => {
        box1pop5wrap.classList.add('on');
        box1pop4wrap.classList.remove('on');
    });

    box1pop5wrap.addEventListener('click', e => {
        box1pop5wrap.classList.remove('on');
        box1.classList.remove('on');
        pop.classList.remove('fade-in');
        openPop.style.display = 'none';
    });
}

const openPopBox2 = () => {
    const box2 = document.querySelector('.box2');
    const box2Openbtn = document.querySelector('.box2-btn');
    const box2Closebtn = box2.querySelector('button');

    box2Openbtn.addEventListener('click', e => {
        e.preventDefault();
        e.stopPropagation();
        box2.classList.add('on');
    });

    box2Closebtn.addEventListener('click', () => {
        box2.classList.remove('on');
    })
}

const openPopBox3 = () => {
    const box3 = document.querySelector('.box3');
    const box3Openbtn = document.querySelector('.box3-btn');
    const box3Closebtn = box3.querySelector('button');
    const box3Step1 = document.querySelector('.box3-step1');
    const box3Step2 = document.querySelector('.box3-step2');
    const box3Step3 = document.querySelector('.box3-step3');
    const box3Step4 = document.querySelector('.box3-step4');
    const box3Step5 = document.querySelector('.box3-step5');


    box3Openbtn.addEventListener('click', e => {
        e.preventDefault();
        e.stopPropagation();
        box3.classList.add('on');
        box3Step1.classList.add('on');
    });

    box3Step1.addEventListener('click', () => {
        box3Step1.classList.remove('on');
        box3Step1.style.display = "none";
        box3Step2.classList.add('on');
    });

    box3Step2.addEventListener('click', () => {
        box3Step2.style.display = "none";
        box3Step2.classList.remove('on');
        box3Step3.classList.add('on');
    });

    box3Step3.addEventListener('click', () => {
        box3Step3.style.display = "none";
        box3Step3.classList.remove('on');
        box3Step4.classList.add('on');
    });

    box3Step4.addEventListener('click', () => {
        box3Step4.style.display = "none";
        box3Step4.classList.remove('on');
        box3Step5.classList.add('on');
    });

    box3Step5.addEventListener('click', () => {
        box3Step5.style.display = "none";
        box3Step5.classList.remove('on');
        box3.classList.remove('on');
    });
}

// 탭
class Tab {
    constructor(container) {
        this.container = container;
        this.tablist = container.querySelector(':scope > [role="tablist"]');

        const panelContainer = container.querySelector(':scope > .tab-panels');

        if (!this.tablist || !panelContainer) return;

        this.tabs = Array.from(this.tablist.querySelectorAll('[role="tab"]'));
        this.panels = Array.from(panelContainer.querySelectorAll(':scope > [role="tabpanel"]'));

        if (this.tabs.length === 0) return;

        this.init();
    }

    init() {
        this.tablist.addEventListener('click', this.handleClick.bind(this));
        this.tablist.addEventListener('keydown', this.handleKeydown.bind(this));
    }

    handleClick(e) {
        const clickedTab = e.target.closest('[role="tab"]');
        if (clickedTab) {
            this.activateTab(clickedTab);
        }
    }

    handleKeydown(e) {
        const currentTab = e.target.closest('[role="tab"]');

        if (!currentTab) return;

        let newIndex = this.tabs.indexOf(currentTab);
        let shouldPreventDefault = true;

        switch (e.key) {
            case 'ArrowLeft':
                newIndex = (newIndex - 1 + this.tabs.length) % this.tabs.length;
                break;
            case 'ArrowRight':
                newIndex = (newIndex + 1) % this.tabs.length;
                break;
            case 'Home': newIndex = 0; break;
            case 'End': newIndex = this.tabs.length - 1; break;
            default: shouldPreventDefault = false; break;
        }

        if (shouldPreventDefault) {
            e.preventDefault();

            this.tabs[newIndex].focus();
            this.activateTab(this.tabs[newIndex]);
        }
    }

    activateTab(tabToActivate) {
        this.tabs.forEach((tab, index) => {
            tab.setAttribute('aria-selected', 'false');
            tab.setAttribute('tabindex', '-1');
        });
        
        this.panels.forEach(panel => {
            panel.setAttribute('hidden', 'true');
        });

        const panelId = tabToActivate.getAttribute('aria-controls');
        const panelToActivate = this.container.querySelector(`#${panelId}`);
        const index = Array.from(tabToActivate.closest('ul').children).indexOf(tabToActivate.parentElement);

        if(!tabToActivate.closest('#sub-tabs')) {
            if(index === 0) {
                document.body.classList.remove('bg2');
            }

            if(index === 1) {
                document.body.classList.add('bg2');
            }
        }

        tabToActivate.setAttribute('aria-selected', 'true');
        tabToActivate.setAttribute('tabindex', '0');
        
        if (panelToActivate) {
            panelToActivate.removeAttribute('hidden');
        }
    }

    openTab(index) {
        if (index >= 0 && index < this.tabs.length) {
            const tabToActivate = this.tabs[index];

            console.log('tabToActivate: ', tabToActivate)

            this.activateTab(tabToActivate);
            tabToActivate.focus();
        } else {
            console.warn(`Tab index ${index} is out of bounds.`);
        }
    }
}

document.addEventListener("DOMContentLoaded", () => {
    headerbanner();
    scrolleff();
    popClose();
    scrollToCloseBtn();
    openPopOnScroll();
    openPopBox1();
    openPopBox2();
    openPopBox3();

      // 탭 인스턴스 생성
    document.querySelectorAll('.tab-container').forEach(container => {
        container.tabsInstance = new Tab(container);
    });
});
</script>